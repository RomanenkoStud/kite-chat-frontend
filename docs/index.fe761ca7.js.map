{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-5cd3477ee07a1079.js","src/controller.ts","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/@parcel/runtime-js/lib/runtime-31a7428090dd4492.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"ixCSO\\\":\\\"index.fe761ca7.js\\\",\\\"bbzeV\\\":\\\"humane-worker.40689ad2.js\\\"}\"));","import {HumaneChatElement} from './';\nimport {\n  ConnectedPayload,\n  ErrorPayload,\n  HumaneMessage,\n  Payload,\n  PayloadType,\n} from './humane-types';\n\nconst requiredElement = <T extends HTMLElement = HTMLElement>(\n  selector: string\n): T => {\n  const el = document.querySelector<T>(selector);\n  if (!el) throw new Error(`Element '${selector}' is missing`);\n  return el;\n};\n\nconst sharedWorker = new SharedWorker(\n  new URL('humane-worker.ts', import.meta.url),\n  {\n    type: 'module',\n    name: 'üë©üèª/humane chat worker',\n  }\n);\n\nsharedWorker.port.onmessage = (e: MessageEvent<Payload>) => {\n  const payload = e.data;\n  if (!payload) throw new Error('no payload');\n  switch (payload.type) {\n    case PayloadType.MSG:\n      handleIncomingMessage(payload);\n      break;\n    case PayloadType.CONNECTED:\n      handleConnected(payload);\n      break;\n    case PayloadType.ERROR:\n      handleError(payload);\n      break;\n  }\n};\n\nconst chat: HumaneChatElement = requiredElement('humane-chat');\nconst textarea: HTMLTextAreaElement = requiredElement('textarea');\nconst sendToChatBtn = requiredElement('#send');\nconst openBtn = requiredElement('#open');\nconst closeBtn = requiredElement('#close');\nconst colorpicker = requiredElement('#colorpicker');\nconst root = document.documentElement;\n\ndocument.addEventListener('humane-chat.send', (e) => {\n  const payload = e.detail;\n  sharedWorker.port.postMessage({type: PayloadType.MSG, ...payload});\n});\n\naddEventListener('beforeunload', () =>\n  sharedWorker.port.postMessage({\n    type: PayloadType.DISCONNECTED,\n    userId: chat.userId,\n  })\n);\n\nsendToChatBtn.addEventListener('click', () => chat.incoming(textarea.value));\nopenBtn.addEventListener('click', () => chat.show());\ncloseBtn.addEventListener('click', () => chat.hide());\ncolorpicker.addEventListener('input', (e) => {\n  const target = e.target as HTMLInputElement;\n  const color = target.value;\n  root.style.setProperty('--humane-primary-color', color);\n});\n\nsharedWorker.port.start();\nsharedWorker.port.postMessage({\n  type: PayloadType.CONNECTED,\n  userId: chat.userId,\n});\n\nfunction handleIncomingMessage(incoming: HumaneMessage) {\n  chat.incoming(incoming.msg, incoming.msgId, incoming.datetime);\n}\n\nfunction handleConnected(connected: ConnectedPayload) {\n  console.log('Connected', connected.userId);\n}\n\nfunction handleError(e: ErrorPayload) {\n  console.error(e.code, e.reason);\n}\n","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","let workerURL = require('./helpers/get-worker-url');\nlet bundleURL = require('./helpers/bundle-url');\nlet url = bundleURL.getBundleURL('ixCSO') + require('./helpers/bundle-manifest').resolve(\"bbzeV\");module.exports = workerURL(url, bundleURL.getOrigin(url), false);"],"names":["$0380ce8f1f064ccc$export$6503ec6e8aabbaf","$0380ce8f1f064ccc$export$f7ad0328861e2f03","$0380ce8f1f064ccc$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$1O62j","$c6da055f7cfa59fd$var$requiredElement","selector","el","document","querySelector","$7dd1ddf6834435ca$export$bdfd709ae4826697","$7dd1ddf6834435ca$export$5a759dc7a1cfb72a","$902f5cabe5153acc$exports","workerUrl","origin","isESM","self","location","source","stringify","URL","createObjectURL","Blob","type","$7dd1ddf6834435ca$var$bundleURL","$7dd1ddf6834435ca$var$getBaseURL","url","replace","value","err","matches","stack","match","$7dd1ddf6834435ca$var$getBundleURL","$6b7f5200657554ce$var$url","resolve","$6b7f5200657554ce$exports","$c6da055f7cfa59fd$var$sharedWorker","SharedWorker","name","port","onmessage","e","payload","data","PayloadType","MSG","incoming","$c6da055f7cfa59fd$var$chat","msg","msgId","datetime","CONNECTED","connected","console","log","userId","ERROR","error","code","reason","$c6da055f7cfa59fd$var$handleError","$c6da055f7cfa59fd$var$textarea","$c6da055f7cfa59fd$var$sendToChatBtn","$c6da055f7cfa59fd$var$openBtn","$c6da055f7cfa59fd$var$closeBtn","$c6da055f7cfa59fd$var$colorpicker","$c6da055f7cfa59fd$var$root","documentElement","addEventListener","detail","postMessage","DISCONNECTED","show","hide","color","target","style","setProperty","start"],"version":3,"file":"index.fe761ca7.js.map"}
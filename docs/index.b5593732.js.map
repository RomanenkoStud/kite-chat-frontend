{"mappings":"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","sources":["src/humane-types.ts","node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-287be38f42a80d43.js","src/controller.ts","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/@parcel/runtime-js/lib/runtime-8c3e5926bd1ac149.js"],"sourcesContent":["export enum Status {\n  UNKNOWN = 'unknown',\n  SENT = 'sent',\n  DELIVERED = 'delivered',\n  READ = 'read',\n}\n\nexport type HumaneMessage = {\n  msg: string;\n  msgId: string;\n  chatId: string;\n  userId: string;\n  datetime: string;\n  status?: Status;\n};\n\nexport const enum PayloadType {\n  MSG = 'msg',\n  CONNECTED = 'connected',\n  DISCONNECTED = 'disconnected',\n  ERROR = 'error',\n}\n\nexport type HumaneMessagePayload = {type: PayloadType.MSG} & HumaneMessage;\nexport type ConnectedPayload = {type: PayloadType.CONNECTED; userId: string};\nexport type DisconnectedPayload = {\n  type: PayloadType.DISCONNECTED;\n  userId: string;\n};\nexport type ErrorPayload = {\n  type: PayloadType.ERROR;\n  reason: string;\n  code: number;\n};\n\nexport type Payload =\n  | HumaneMessagePayload\n  | ConnectedPayload\n  | DisconnectedPayload\n  | ErrorPayload;\n","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"2wKWK\\\":\\\"index.b5593732.js\\\",\\\"bbzeV\\\":\\\"humane-worker.40689ad2.js\\\"}\"));","import {HumaneChatElement} from './';\nimport {\n  ConnectedPayload,\n  ErrorPayload,\n  HumaneMessage,\n  Payload,\n  PayloadType,\n} from './humane-types';\n\nconst requiredElement = <T extends HTMLElement = HTMLElement>(\n  selector: string\n): T => {\n  const el = document.querySelector<T>(selector);\n  if (!el) throw new Error(`Element '${selector}' is missing`);\n  return el;\n};\n\nconst sharedWorker = new SharedWorker(\n  new URL('humane-worker.ts', import.meta.url),\n  {\n    type: 'module',\n    name: 'üë©üèª/humane chat worker',\n  }\n);\n\nsharedWorker.port.onmessage = (e: MessageEvent<Payload>) => {\n  const payload = e.data;\n  if (!payload) throw new Error('no payload');\n  switch (payload.type) {\n    case PayloadType.MSG:\n      handleIncomingMessage(payload);\n      break;\n    case PayloadType.CONNECTED:\n      handleConnected(payload);\n      break;\n    case PayloadType.ERROR:\n      handleError(payload);\n      break;\n  }\n};\n\nconst chat: HumaneChatElement = requiredElement('humane-chat');\nconst textarea: HTMLTextAreaElement = requiredElement('textarea');\nconst sendToChatBtn = requiredElement('#send');\nconst openBtn = requiredElement('#open');\nconst closeBtn = requiredElement('#close');\nconst colorpicker = requiredElement('#colorpicker');\nconst root = document.documentElement;\n\ndocument.addEventListener('humane-chat.send', (e) => {\n  const payload = e.detail;\n  sharedWorker.port.postMessage({type: PayloadType.MSG, ...payload});\n});\n\naddEventListener('beforeunload', () =>\n  sharedWorker.port.postMessage({\n    type: PayloadType.DISCONNECTED,\n    userId: chat.userId,\n  })\n);\n\nsendToChatBtn.addEventListener('click', () => chat.incoming(textarea.value));\nopenBtn.addEventListener('click', () => chat.show());\ncloseBtn.addEventListener('click', () => chat.hide());\ncolorpicker.addEventListener('input', (e) => {\n  const target = e.target as HTMLInputElement;\n  const color = target.value;\n  root.style.setProperty('--humane-primary-color', color);\n});\n\nsharedWorker.port.start();\nsharedWorker.port.postMessage({\n  type: PayloadType.CONNECTED,\n  userId: chat.userId,\n});\n\nfunction handleIncomingMessage(incoming: HumaneMessage) {\n  chat.incoming(incoming.msg, incoming.msgId, incoming.datetime);\n}\n\nfunction handleConnected(connected: ConnectedPayload) {\n  console.log('Connected', connected.userId);\n}\n\nfunction handleError(e: ErrorPayload) {\n  console.error(e.code, e.reason);\n}\n","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","let workerURL = require('./helpers/get-worker-url');\nlet url = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"bbzeV\"));\nmodule.exports = workerURL(url.toString(), url.origin, true);"],"names":["$c670324660e9595c$export$96e9906d6d93a972","Status","$c670324660e9595c$export$3a0d79760672f45c","PayloadType","$ef7689007096c8a0$export$6503ec6e8aabbaf","$ef7689007096c8a0$export$f7ad0328861e2f03","$ef7689007096c8a0$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$facbc892e9f63612$var$requiredElement","selector","el","document","querySelector","$cfc619e94ff51e3f$exports","workerUrl","origin","isESM","self","location","source","stringify","URL","createObjectURL","Blob","type","$255bc42ab8a924fc$var$url","resolve","import","meta","url","$255bc42ab8a924fc$exports","toString","$facbc892e9f63612$var$sharedWorker","SharedWorker","name","port","onmessage","e","payload","data","MSG","incoming","$facbc892e9f63612$var$chat","msg","msgId","datetime","CONNECTED","connected","console","log","userId","ERROR","error","code","reason","$facbc892e9f63612$var$handleError","$facbc892e9f63612$var$textarea","$facbc892e9f63612$var$sendToChatBtn","$facbc892e9f63612$var$openBtn","$facbc892e9f63612$var$closeBtn","$facbc892e9f63612$var$colorpicker","$facbc892e9f63612$var$root","documentElement","addEventListener","detail","postMessage","DISCONNECTED","value","show","hide","color","target","style","setProperty","start"],"version":3,"file":"index.b5593732.js.map"}